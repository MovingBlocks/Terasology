// Copyright 2020 The Terasology Foundation
// SPDX-License-Identifier: Apache-2.0

// This magically allows subdirs in this subproject to themselves become sub-subprojects in a proper tree structure
// so getting a library and build it should work, e.g.:
//    ./groovyw lib get TeraNUI
//    ./gradlew :TeraNUI:build
new File(rootDir, 'libs').eachDir { possibleSubprojectDir ->
    def subprojectName = ':libs:' + possibleSubprojectDir.name
    File buildFile = new File(possibleSubprojectDir, "build.gradle")
    File settingsFile = new File(possibleSubprojectDir, "settings.gradle")
    if (!buildFile.exists()) {
        logger.warn("***** WARNING: Found a lib without a build.gradle, corrupt dir? NOT including {} *****", subprojectName)
        return
    }
    if (!settingsFile.exists()) {
        logger.warn("lib {} has build.gradle, but no settings.gradle? NOT including it." subprojectName)
        return
    }
    logger.info("lib {} has a build file so counting it complete and including it.", subprojectName)
    includeBuild(possibleSubprojectDir)
}
